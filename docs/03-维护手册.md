# Leantime Blog Plugin - ç»´æŠ¤æ‰‹å†Œ

**ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-12-13

---

## ğŸ“‹ ç›®å½•

1. [æ—¥å¸¸ç»´æŠ¤](#ä¸€æ—¥å¸¸ç»´æŠ¤)
2. [ç›‘æ§å’Œæ—¥å¿—](#äºŒç›‘æ§å’Œæ—¥å¿—)
3. [å¤‡ä»½å’Œæ¢å¤](#ä¸‰å¤‡ä»½å’Œæ¢å¤)
4. [æ€§èƒ½ä¼˜åŒ–](#å››æ€§èƒ½ä¼˜åŒ–)
5. [æ•…éšœæ’æŸ¥](#äº”æ•…éšœæ’æŸ¥)
6. [å®‰å…¨ç»´æŠ¤](#å…­å®‰å…¨ç»´æŠ¤)
7. [æ›´æ–°å‡çº§](#ä¸ƒæ›´æ–°å‡çº§)

---

## ä¸€ã€æ—¥å¸¸ç»´æŠ¤

### 1.1 å¥åº·æ£€æŸ¥

**æ¯æ—¥æ£€æŸ¥æ¸…å•**ï¼š

```bash
# 1. æ£€æŸ¥ Leantime å®¹å™¨çŠ¶æ€
docker-compose -f D:\github\leantime\docker\docker-compose.yml ps

# åº”æ˜¾ç¤º: leantime-web-prod (healthy), leantime-mysql-prod (healthy)

# 2. æ£€æŸ¥åšå®¢æ•°æ®è¡¨
docker exec -it leantime-mysql-prod mysql -uleantime -p -e "
  SELECT COUNT(*) as total_posts FROM leantime.zp_blog_posts;
  SELECT COUNT(*) as published_posts FROM leantime.zp_blog_posts WHERE status='published';
  SELECT COUNT(*) as draft_posts FROM leantime.zp_blog_posts WHERE status='draft';
"

# å¯†ç : your_db_password

# 3. æµ‹è¯• API è®¿é—®
curl -I http://your-leantime-url

# 4. æµ‹è¯• API å¯†é’¥
curl -X POST http://your-leantime-url/api/jsonrpc \
  -H "x-api-key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"leantime.rpc.blog.listPosts","params":{},"id":"health-check"}'

# 5. æ£€æŸ¥è‡ªåŠ¨å‘å¸ƒå·¥å…·çŠ¶æ€ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
.\leantime-publisher.ps1 -Status  # PowerShell
# æˆ–
ps aux | grep leantime_publisher  # Python
```

### 1.2 ç»´æŠ¤è®¡åˆ’

| é¢‘ç‡ | ä»»åŠ¡ | è´Ÿè´£äºº |
|------|------|--------|
| **æ¯å¤©** | æ£€æŸ¥æœåŠ¡çŠ¶æ€ã€æŸ¥çœ‹æ—¥å¿— | è¿ç»´ |
| **æ¯å‘¨** | å¤‡ä»½æ•°æ®åº“ã€æ¸…ç†æ—§æ—¥å¿— | è¿ç»´ |
| **æ¯æœˆ** | æ€§èƒ½åˆ†æã€å®‰å…¨å®¡è®¡ã€æ›´æ–°æ£€æŸ¥ | è¿ç»´ + å¼€å‘ |
| **æ¯å­£åº¦** | å®¹é‡è§„åˆ’ã€ç¾éš¾æ¢å¤æ¼”ç»ƒ | æŠ€æœ¯ä¸»ç®¡ |

---

## äºŒã€ç›‘æ§å’Œæ—¥å¿—

### 2.1 æ—¥å¿—ä½ç½®

| ç±»å‹ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| **Leantime åº”ç”¨æ—¥å¿—** | `D:\Docker\volumes\leantime\web-data\storage\logs` | Laravel æ—¥å¿— |
| **Nginx è®¿é—®æ—¥å¿—** | å®¹å™¨å†… `/var/log/nginx/access.log` | Web è®¿é—®æ—¥å¿— |
| **Nginx é”™è¯¯æ—¥å¿—** | å®¹å™¨å†… `/var/log/nginx/error.log` | Web é”™è¯¯æ—¥å¿— |
| **MySQL é”™è¯¯æ—¥å¿—** | å®¹å™¨å†… `/var/log/mysql/error.log` | æ•°æ®åº“é”™è¯¯ |
| **Docker å®¹å™¨æ—¥å¿—** | `docker logs leantime-web-prod` | å®¹å™¨æ ‡å‡†è¾“å‡º |
| **è‡ªåŠ¨å‘å¸ƒå·¥å…·æ—¥å¿—** | `%USERPROFILE%\.leantime-publisher\leantime-publisher.log` | å‘å¸ƒå·¥å…·æ—¥å¿— |

### 2.2 æŸ¥çœ‹æ—¥å¿—

```bash
# 1. Leantime åº”ç”¨æ—¥å¿—
docker exec leantime-web-prod tail -f /var/www/html/storage/logs/laravel.log

# 2. Docker å®¹å™¨æ—¥å¿—
docker logs leantime-web-prod --tail=100 -f

# 3. MySQL æ…¢æŸ¥è¯¢æ—¥å¿—
docker exec leantime-mysql-prod tail -f /var/log/mysql/slow.log

# 4. Nginx è®¿é—®æ—¥å¿—
docker exec leantime-web-prod tail -f /var/log/nginx/access.log

# 5. è‡ªåŠ¨å‘å¸ƒå·¥å…·æ—¥å¿—
tail -f $env:USERPROFILE\.leantime-publisher\leantime-publisher.log
```

### 2.3 æ—¥å¿—åˆ†æ

**æŸ¥æ‰¾é”™è¯¯**ï¼š

```bash
# æŸ¥æ‰¾æœ€è¿‘çš„é”™è¯¯
docker logs leantime-web-prod --since 1h | grep -i error

# æŸ¥æ‰¾ 500 é”™è¯¯
docker exec leantime-web-prod grep "HTTP/1.1\" 500" /var/log/nginx/access.log

# æŸ¥æ‰¾æ…¢æŸ¥è¯¢
docker exec leantime-mysql-prod grep "Query_time" /var/log/mysql/slow.log
```

### 2.4 æ—¥å¿—æ¸…ç†

```bash
# æ¸…ç† 30 å¤©å‰çš„æ—¥å¿—
find D:\Docker\volumes\leantime\web-data\storage\logs -name "*.log" -mtime +30 -delete

# æ¸…ç† Docker æ—¥å¿—ï¼ˆé‡å¯å®¹å™¨ä¼šæ¸…ç©ºæ ‡å‡†è¾“å‡ºæ—¥å¿—ï¼‰
docker-compose -f D:\github\leantime\docker\docker-compose.yml restart leantime

# æ¸…ç†è‡ªåŠ¨å‘å¸ƒå·¥å…·æ—¥å¿—
$logFile = "$env:USERPROFILE\.leantime-publisher\leantime-publisher.log"
if ((Get-Item $logFile).Length -gt 10MB) {
    Move-Item $logFile "${logFile}.old"
    New-Item $logFile -ItemType File
}
```

---

## ä¸‰ã€å¤‡ä»½å’Œæ¢å¤

### 3.1 å¤‡ä»½ç­–ç•¥

| å¤‡ä»½ç±»å‹ | é¢‘ç‡ | ä¿ç•™æ—¶é—´ | è¯´æ˜ |
|---------|------|---------|------|
| **å®Œæ•´å¤‡ä»½** | æ¯å‘¨ | 30 å¤© | æ•°æ®åº“ + æ–‡ä»¶ |
| **å¢é‡å¤‡ä»½** | æ¯å¤© | 7 å¤© | ä»…æ•°æ®åº“ |
| **æ–‡ä»¶å¿«ç…§** | æ¯å¤© | 7 å¤© | ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ |

### 3.2 æ•°æ®åº“å¤‡ä»½

**æ‰‹åŠ¨å¤‡ä»½**ï¼š

```bash
# å®Œæ•´å¤‡ä»½
mysqldump -h localhost -P 6105 -u leantime -p --databases leantime \
  --single-transaction --quick --lock-tables=false \
  > D:\github\leantime\backups\leantime_full_$(date +%Y%m%d_%H%M%S).sql

# å¯†ç : your_db_password

# ä»…å¤‡ä»½åšå®¢æ•°æ®è¡¨
mysqldump -h localhost -P 6105 -u leantime -p leantime \
  zp_blog_posts zp_blog_categories zp_blog_tags zp_blog_post_tags zp_blog_comments \
  > D:\github\leantime\backups\blog_backup_$(date +%Y%m%d).sql
```

**è‡ªåŠ¨å¤‡ä»½è„šæœ¬**ï¼ˆPowerShellï¼‰ï¼š

åˆ›å»º `D:\github\leantime\backups\backup-blog.ps1`:

```powershell
# Blog æ•°æ®åº“å¤‡ä»½è„šæœ¬
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$backupDir = "D:\github\leantime\backups\daily"
$backupFile = "$backupDir\blog_backup_$timestamp.sql"

# åˆ›å»ºå¤‡ä»½ç›®å½•
New-Item -ItemType Directory -Path $backupDir -Force | Out-Null

# æ‰§è¡Œå¤‡ä»½
docker exec leantime-mysql-prod mysqldump -uleantime -pyour_db_password leantime `
  zp_blog_posts zp_blog_categories zp_blog_tags zp_blog_post_tags zp_blog_comments `
  > $backupFile

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
Compress-Archive -Path $backupFile -DestinationPath "$backupFile.zip"
Remove-Item $backupFile

# åˆ é™¤ 7 å¤©å‰çš„å¤‡ä»½
Get-ChildItem $backupDir -Filter "*.zip" | Where-Object { $_.LastWriteTime -lt (Get-Date).AddDays(-7) } | Remove-Item

Write-Host "âœ… å¤‡ä»½å®Œæˆ: $backupFile.zip"
```

**è®¾ç½®å®šæ—¶ä»»åŠ¡**ï¼š

```powershell
# åˆ›å»ºæ¯æ—¥å‡Œæ™¨ 2:00 æ‰§è¡Œçš„å¤‡ä»½ä»»åŠ¡
$action = New-ScheduledTaskAction -Execute "powershell.exe" `
  -Argument "-File D:\github\leantime\backups\backup-blog.ps1"

$trigger = New-ScheduledTaskTrigger -Daily -At 2:00AM

Register-ScheduledTask -TaskName "LeantimeBlogBackup" `
  -Action $action -Trigger $trigger `
  -Description "æ¯æ—¥å¤‡ä»½ Leantime Blog æ•°æ®"
```

### 3.3 æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶
$timestamp = Get-Date -Format "yyyyMMdd"
$source = "D:\Docker\volumes\leantime\web-data"
$destination = "D:\github\leantime\backups\files\web-data_$timestamp.zip"

Compress-Archive -Path $source -DestinationPath $destination

Write-Host "âœ… æ–‡ä»¶å¤‡ä»½å®Œæˆ: $destination"
```

### 3.4 æ•°æ®æ¢å¤

**æ¢å¤æ•°æ®åº“**ï¼š

```bash
# 1. åœæ­¢ Leantime æœåŠ¡
docker-compose -f D:\github\leantime\docker\docker-compose.yml stop leantime

# 2. æ¢å¤æ•°æ®åº“
mysql -h localhost -P 6105 -u leantime -p leantime < D:\github\leantime\backups\leantime_full_20251213.sql

# å¯†ç : your_db_password

# 3. å¯åŠ¨ Leantime æœåŠ¡
docker-compose -f D:\github\leantime\docker\docker-compose.yml start leantime

# 4. éªŒè¯æ¢å¤
curl http://your-leantime-url
```

**æ¢å¤æ–‡ä»¶**ï¼š

```bash
# è§£å‹å¤‡ä»½æ–‡ä»¶
Expand-Archive -Path "D:\github\leantime\backups\files\web-data_20251213.zip" `
  -DestinationPath "D:\Docker\volumes\leantime\web-data" -Force
```

---

## å››ã€æ€§èƒ½ä¼˜åŒ–

### 4.1 æ•°æ®åº“ä¼˜åŒ–

**æŸ¥è¯¢åˆ†æ**ï¼š

```sql
-- æŸ¥æ‰¾æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log ORDER BY query_time DESC LIMIT 10;

-- åˆ†æè¡¨
ANALYZE TABLE zp_blog_posts;
ANALYZE TABLE zp_blog_categories;
ANALYZE TABLE zp_blog_tags;

-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE zp_blog_posts;
OPTIMIZE TABLE zp_blog_post_tags;

-- æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SHOW INDEX FROM zp_blog_posts;
```

**æ·»åŠ ç´¢å¼•**ï¼ˆå¦‚æœæ€§èƒ½ä¸è¶³ï¼‰ï¼š

```sql
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢æ·»åŠ ç´¢å¼•
CREATE INDEX idx_posts_status_published ON zp_blog_posts (status, published_at);
CREATE INDEX idx_posts_project ON zp_blog_posts (project_id);
CREATE INDEX idx_posts_author ON zp_blog_posts (author_id);
```

### 4.2 ç¼“å­˜é…ç½®

**å¯ç”¨ PHP OPcache**ï¼š

ç¼–è¾‘ `D:\github\leantime\docker\docker-compose.yml`ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼š

```yaml
leantime:
  environment:
    # ... ç°æœ‰é…ç½® ...
    - PHP_OPCACHE_ENABLE=1
    - PHP_OPCACHE_MEMORY_CONSUMPTION=128
    - PHP_OPCACHE_MAX_ACCELERATED_FILES=10000
```

**æ¸…é™¤ç¼“å­˜**ï¼š

```bash
# æ¸…é™¤ Laravel ç¼“å­˜
docker exec leantime-web-prod php artisan cache:clear
docker exec leantime-web-prod php artisan config:clear
docker exec leantime-web-prod php artisan view:clear

# é‡å¯å®¹å™¨
docker-compose -f D:\github\leantime\docker\docker-compose.yml restart leantime
```

### 4.3 èµ„æºç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats leantime-web-prod leantime-mysql-prod

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
docker exec leantime-mysql-prod mysql -uleantime -p -e "
  SELECT
    table_name AS 'Table',
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS 'Size (MB)'
  FROM information_schema.TABLES
  WHERE table_schema = 'leantime' AND table_name LIKE 'zp_blog%'
  ORDER BY (data_length + index_length) DESC;
"
```

---

## äº”ã€æ•…éšœæ’æŸ¥

### 5.1 å¸¸è§é—®é¢˜

#### é—®é¢˜ 1: åšå®¢é¡µé¢ 404

**ç—‡çŠ¶**: è®¿é—® `/blog/list` è¿”å› 404

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥æ’ä»¶æ˜¯å¦å¯ç”¨
docker exec leantime-web-prod cat /var/www/html/.env | grep PLUGINS

# 2. æ£€æŸ¥æ’ä»¶æ–‡ä»¶æ˜¯å¦å­˜åœ¨
docker exec leantime-web-prod ls -la /var/www/html/app/Plugins/LeantimeBlog

# 3. æ¸…é™¤è·¯ç”±ç¼“å­˜
docker exec leantime-web-prod php artisan route:clear
docker exec leantime-web-prod php artisan cache:clear

# 4. é‡å¯æœåŠ¡
docker-compose -f D:\github\leantime\docker\docker-compose.yml restart leantime
```

#### é—®é¢˜ 2: API è¿”å› 500 é”™è¯¯

**ç—‡çŠ¶**: API è°ƒç”¨è¿”å› Internal Server Error

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker exec leantime-web-prod tail -50 /var/www/html/storage/logs/laravel.log

# 2. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
docker exec leantime-web-prod tail -50 /var/log/nginx/error.log

# 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec leantime-mysql-prod mysql -uleantime -p -e "SELECT 1"

# 4. æµ‹è¯•ç®€å• API
curl -X POST http://your-leantime-url/api/jsonrpc \
  -H "x-api-key: your_api_key_here" \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"leantime.rpc.system.ping","params":{},"id":"test"}'
```

#### é—®é¢˜ 3: Markdown æ¸²æŸ“å¤±è´¥

**ç—‡çŠ¶**: æ–‡ç« å†…å®¹æ˜¾ç¤ºä¸ºçº¯æ–‡æœ¬

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥ Composer ä¾èµ–
docker exec leantime-web-prod composer show | grep commonmark

# 2. é‡æ–°å®‰è£…ä¾èµ–
docker exec leantime-web-prod composer install --no-dev

# 3. æ¸…é™¤è§†å›¾ç¼“å­˜
docker exec leantime-web-prod php artisan view:clear

# 4. æ£€æŸ¥ MarkdownService
docker exec leantime-web-prod cat /var/www/html/app/Plugins/LeantimeBlog/Services/MarkdownService.php
```

#### é—®é¢˜ 4: è‡ªåŠ¨å‘å¸ƒå·¥å…·ä¸å·¥ä½œ

**ç—‡çŠ¶**: ä¿å­˜ Markdown æ–‡ä»¶åæ²¡æœ‰è‡ªåŠ¨å‘å¸ƒ

**æ’æŸ¥æ­¥éª¤**ï¼š

```powershell
# 1. æ£€æŸ¥å·¥å…·æ˜¯å¦è¿è¡Œ
Get-Process | Where-Object { $_.ProcessName -like "*powershell*" -or $_.ProcessName -like "*python*" }

# 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
Get-Content "$env:USERPROFILE\.leantime-publisher\config.json"

# 3. æ£€æŸ¥æ—¥å¿—
Get-Content "$env:USERPROFILE\.leantime-publisher\leantime-publisher.log" -Tail 50

# 4. æ‰‹åŠ¨æµ‹è¯•å‘å¸ƒ
$testFile = "D:\Blog\Posts\test-manual.md"
@"
---
title: æ‰‹åŠ¨æµ‹è¯•
status: draft
---
# æµ‹è¯•å†…å®¹
"@ | Set-Content $testFile

# è§‚å¯Ÿæ—¥å¿—è¾“å‡º
```

### 5.2 ç´§æ€¥æ¢å¤æµç¨‹

**åœºæ™¯**: ç³»ç»Ÿå´©æºƒï¼Œéœ€è¦å¿«é€Ÿæ¢å¤

```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f D:\github\leantime\docker\docker-compose.yml down

# 2. æ¢å¤æ•°æ®åº“ï¼ˆä»æœ€æ–°å¤‡ä»½ï¼‰
$latestBackup = Get-ChildItem "D:\github\leantime\backups\daily" -Filter "*.sql.zip" | Sort-Object LastWriteTime -Descending | Select-Object -First 1

Expand-Archive -Path $latestBackup.FullName -DestinationPath "D:\Temp" -Force
$sqlFile = Get-ChildItem "D:\Temp" -Filter "*.sql" | Select-Object -First 1

# 3. å¯åŠ¨ MySQL
docker-compose -f D:\github\leantime\docker\docker-compose.yml up -d mysql

# ç­‰å¾… MySQL å¯åŠ¨
Start-Sleep -Seconds 10

# 4. æ¢å¤æ•°æ®
Get-Content $sqlFile.FullName | docker exec -i leantime-mysql-prod mysql -uleantime -p'your_db_password' leantime

# 5. å¯åŠ¨ Leantime
docker-compose -f D:\github\leantime\docker\docker-compose.yml up -d leantime

# 6. éªŒè¯æ¢å¤
Start-Sleep -Seconds 5
curl http://your-leantime-url

# 7. æ£€æŸ¥åšå®¢æ•°æ®
docker exec leantime-mysql-prod mysql -uleantime -p'your_db_password' -e "SELECT COUNT(*) FROM leantime.zp_blog_posts"
```

---

## å…­ã€å®‰å…¨ç»´æŠ¤

### 6.1 å®šæœŸå®‰å…¨æ£€æŸ¥

**æ¯æœˆå®‰å…¨æ£€æŸ¥æ¸…å•**ï¼š

- [ ] æ›´æ–° Leantime åˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] æ›´æ–° Docker é•œåƒ
- [ ] æ£€æŸ¥å¹¶æ›´æ¢ API Key
- [ ] å®¡è®¡ç”¨æˆ·æƒé™
- [ ] æ£€æŸ¥æ—¥å¿—å¼‚å¸¸è®¿é—®
- [ ] å¤‡ä»½éªŒè¯ï¼ˆå°è¯•æ¢å¤ï¼‰
- [ ] æ›´æ–°å¯†ç ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰

### 6.2 API Key ç®¡ç†

```bash
# åˆ—å‡ºæ‰€æœ‰ API Key
docker exec leantime-mysql-prod mysql -uleantime -p -e "
  SELECT id, name, created_at, expires_at, is_active
  FROM leantime.zp_api_keys
  ORDER BY created_at DESC;
"

# ç¦ç”¨æ—§çš„ API Key
docker exec leantime-mysql-prod mysql -uleantime -p -e "
  UPDATE leantime.zp_api_keys SET is_active = 0 WHERE id = 123;
"

# åˆ é™¤è¿‡æœŸçš„ API Key
docker exec leantime-mysql-prod mysql -uleantime -p -e "
  DELETE FROM leantime.zp_api_keys WHERE expires_at < NOW();
"
```

### 6.3 è®¿é—®æ—¥å¿—å®¡è®¡

```bash
# æŸ¥æ‰¾å¯ç–‘çš„ API è®¿é—®
docker exec leantime-web-prod grep "POST /api/jsonrpc" /var/log/nginx/access.log | \
  grep -v "your_api_key_here"

# ç»Ÿè®¡ API è°ƒç”¨é¢‘ç‡
docker exec leantime-web-prod awk '$7 ~ /\/api\/jsonrpc/ {print $1}' /var/log/nginx/access.log | \
  sort | uniq -c | sort -nr | head -20

# æŸ¥æ‰¾å¤±è´¥çš„ç™»å½•å°è¯•
docker exec leantime-web-prod grep "POST /auth/login" /var/log/nginx/access.log | grep "\" 401"
```

---

## ä¸ƒã€æ›´æ–°å‡çº§

### 7.1 æ’ä»¶æ›´æ–°

```bash
# 1. å¤‡ä»½æ•°æ®åº“
mysqldump -h localhost -P 6105 -u leantime -p leantime > backup_before_upgrade.sql

# 2. è¿›å…¥æ’ä»¶ç›®å½•
cd D:\github\leantime\app\Plugins\LeantimeBlog

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 4. æ›´æ–°ä¾èµ–
composer install --no-dev --optimize-autoloader

# 5. è¿è¡Œæ–°çš„è¿ç§»
cd D:\github\leantime
php artisan migrate --path=app/Plugins/LeantimeBlog/Migrations

# 6. æ¸…é™¤ç¼“å­˜
docker exec leantime-web-prod php artisan cache:clear
docker exec leantime-web-prod php artisan config:clear
docker exec leantime-web-prod php artisan view:clear

# 7. é‡å¯æœåŠ¡
docker-compose -f docker\docker-compose.yml restart leantime

# 8. éªŒè¯å‡çº§
curl http://your-leantime-url/blog/list
```

### 7.2 Leantime æ ¸å¿ƒæ›´æ–°

```bash
# 1. æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
docker exec leantime-web-prod cat /var/www/html/version

# 2. å¤‡ä»½æ•°æ®
# ï¼ˆè§ 3.2 èŠ‚ï¼‰

# 3. æ‹‰å–æœ€æ–°é•œåƒ
docker-compose -f D:\github\leantime\docker\docker-compose.yml pull leantime

# 4. é‡å¯å®¹å™¨
docker-compose -f D:\github\leantime\docker\docker-compose.yml up -d --force-recreate leantime

# 5. è¿è¡Œè¿ç§»
docker exec leantime-web-prod php artisan migrate

# 6. éªŒè¯
curl http://your-leantime-url
```

---

## å…«ã€ç»´æŠ¤è„šæœ¬

### 8.1 æ¯æ—¥å¥åº·æ£€æŸ¥è„šæœ¬

åˆ›å»º `D:\github\leantime\scripts\daily-health-check.ps1`:

```powershell
# æ¯æ—¥å¥åº·æ£€æŸ¥è„šæœ¬
Write-Host "=== Leantime Blog å¥åº·æ£€æŸ¥ ===" -ForegroundColor Cyan
Write-Host ""

# 1. å®¹å™¨çŠ¶æ€
Write-Host "1. æ£€æŸ¥å®¹å™¨çŠ¶æ€..." -ForegroundColor Yellow
docker-compose -f D:\github\leantime\docker\docker-compose.yml ps

# 2. ç£ç›˜ç©ºé—´
Write-Host "`n2. æ£€æŸ¥ç£ç›˜ç©ºé—´..." -ForegroundColor Yellow
Get-PSDrive D | Select-Object @{N='FreeGB';E={[math]::Round($_.Free/1GB,2)}}

# 3. æ•°æ®åº“è¿æ¥
Write-Host "`n3. æ£€æŸ¥æ•°æ®åº“è¿æ¥..." -ForegroundColor Yellow
docker exec leantime-mysql-prod mysql -uleantime -p'your_db_password' -e "SELECT 1" 2>&1 | Out-Null
if ($?) { Write-Host "âœ… æ•°æ®åº“æ­£å¸¸" -ForegroundColor Green } else { Write-Host "âŒ æ•°æ®åº“å¼‚å¸¸" -ForegroundColor Red }

# 4. Web æœåŠ¡
Write-Host "`n4. æ£€æŸ¥ Web æœåŠ¡..." -ForegroundColor Yellow
$response = curl -s -o /dev/null -w "%{http_code}" http://your-leantime-url
if ($response -eq 200 -or $response -eq 302) {
    Write-Host "âœ… Web æœåŠ¡æ­£å¸¸ (HTTP $response)" -ForegroundColor Green
} else {
    Write-Host "âŒ Web æœåŠ¡å¼‚å¸¸ (HTTP $response)" -ForegroundColor Red
}

# 5. API æµ‹è¯•
Write-Host "`n5. æ£€æŸ¥ API..." -ForegroundColor Yellow
$apiTest = curl -X POST http://your-leantime-url/api/jsonrpc `
  -H "x-api-key: your_api_key_here" `
  -H "Content-Type: application/json" `
  -d '{"jsonrpc":"2.0","method":"leantime.rpc.blog.listPosts","params":{},"id":"health"}' 2>&1

if ($apiTest -match "result") {
    Write-Host "âœ… API æ­£å¸¸" -ForegroundColor Green
} else {
    Write-Host "âŒ API å¼‚å¸¸" -ForegroundColor Red
}

# 6. åšå®¢ç»Ÿè®¡
Write-Host "`n6. åšå®¢ç»Ÿè®¡..." -ForegroundColor Yellow
docker exec leantime-mysql-prod mysql -uleantime -p'your_db_password' leantime -e "
  SELECT
    COUNT(*) as æ€»æ–‡ç« æ•°,
    SUM(CASE WHEN status='published' THEN 1 ELSE 0 END) as å·²å‘å¸ƒ,
    SUM(CASE WHEN status='draft' THEN 1 ELSE 0 END) as è‰ç¨¿
  FROM zp_blog_posts;
"

Write-Host "`n=== æ£€æŸ¥å®Œæˆ ===" -ForegroundColor Cyan
```

è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š

```powershell
$action = New-ScheduledTaskAction -Execute "powershell.exe" `
  -Argument "-File D:\github\leantime\scripts\daily-health-check.ps1"

$trigger = New-ScheduledTaskTrigger -Daily -At 9:00AM

Register-ScheduledTask -TaskName "LeantimeBlogHealthCheck" `
  -Action $action -Trigger $trigger `
  -Description "æ¯æ—¥ Leantime Blog å¥åº·æ£€æŸ¥"
```

---

## ä¹ã€å®¹é‡è§„åˆ’

### 9.1 å­˜å‚¨å¢é•¿é¢„ä¼°

```bash
# æŸ¥çœ‹æ•°æ®åº“å¢é•¿è¶‹åŠ¿
docker exec leantime-mysql-prod mysql -uleantime -p -e "
  SELECT
    DATE(created_at) as date,
    COUNT(*) as posts_created,
    SUM(LENGTH(content)) / 1024 / 1024 as content_size_mb
  FROM leantime.zp_blog_posts
  GROUP BY DATE(created_at)
  ORDER BY date DESC
  LIMIT 30;
"
```

### 9.2 èµ„æºéœ€æ±‚

| æ–‡ç« æ•°é‡ | æ•°æ®åº“å¤§å° | å»ºè®®å†…å­˜ | å»ºè®® CPU |
|---------|----------|---------|---------|
| 0-100 | < 10MB | 512MB | 1 æ ¸ |
| 100-1000 | 10-100MB | 1GB | 2 æ ¸ |
| 1000-10000 | 100MB-1GB | 2GB | 2 æ ¸ |
| 10000+ | > 1GB | 4GB+ | 4 æ ¸+ |

---

**ç»´æŠ¤æ‰‹å†Œç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-12-13
**ç»´æŠ¤è€…**: Claude Code
