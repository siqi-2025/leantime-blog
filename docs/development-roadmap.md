# Leantime Blog 插件后续开发计划

> Blog 插件功能完善和优化路线图
>
> **当前版本**: v0.1.0-alpha
> **目标版本**: v1.0.0
> **预计完成时间**: 2-3 周

---

## 目录

1. [当前状态](#1-当前状态)
2. [未完成功能](#2-未完成功能)
3. [技术债务](#3-技术债务)
4. [开发优先级](#4-开发优先级)
5. [详细开发任务](#5-详细开发任务)
6. [测试计划](#6-测试计划)
7. [性能优化](#7-性能优化)
8. [文档和部署](#8-文档和部署)

---

## 1. 当前状态

### ✅ 已完成功能

#### 1.1 核心基础设施
- [x] 插件注册系统（`register.php`）
- [x] PSR-4 自动加载器
- [x] 菜单集成（personal 和 default 菜单）
- [x] 数据库表结构（`zp_blog_posts`）
- [x] 基础路由配置

#### 1.2 测试基础设施
- [x] Playwright 测试环境搭建
- [x] 基础测试套件（菜单可见性测试）
- [x] 截图脚本
- [x] 测试辅助函数

#### 1.3 文档
- [x] 插件开发完整指南
- [x] Playwright 测试完整指南
- [x] 后续开发计划（本文档）

### ⚠️ 部分完成功能

#### 1.4 基础控制器
- [~] `Controllers/ShowList.php` - 仅有基础框架，无视图实现
- [ ] 其他控制器均未实现

#### 1.5 API 服务
- [~] API 路由已注册，但服务类未实现
- [ ] BlogApiService 类不存在

### ❌ 未完成功能

- [ ] 完整的 CRUD 操作
- [ ] Markdown 编辑器集成
- [ ] 文章分类和标签
- [ ] 图片上传和管理
- [ ] 文章发布管理
- [ ] 外部平台发布（Medium, Dev.to, Hashnode）
- [ ] 用户界面（UI）
- [ ] 权限控制
- [ ] 数据验证
- [ ] 完整的测试覆盖

---

## 2. 未完成功能

### 2.1 核心 CRUD 功能

#### 文章列表（ShowList）
**状态**: 部分完成（仅控制器框架）

**需要实现**:
- [ ] 列表页面视图（Blade 模板）
- [ ] 分页功能
- [ ] 搜索和过滤
- [ ] 排序功能（按时间、标题、状态）
- [ ] 批量操作（批量删除、批量发布）

**预计工作量**: 4-6 小时

---

#### 创建文章（Create）
**状态**: 未开始

**需要实现**:
- [ ] `Controllers/Create.php`
- [ ] 创建表单视图
- [ ] Markdown 编辑器集成
  - 推荐使用：EasyMDE 或 SimpleMDE
  - 实时预览功能
  - 工具栏配置
- [ ] 文件上传功能
  - 图片上传
  - 附件上传
  - 七牛云/阿里云 OSS 集成（可选）
- [ ] 表单验证
  - 标题必填（2-200 字符）
  - 内容必填
  - slug 自动生成或手动输入
- [ ] 草稿保存功能
- [ ] 自动保存（每 30 秒）

**预计工作量**: 8-10 小时

---

#### 编辑文章（Edit）
**状态**: 未开始

**需要实现**:
- [ ] `Controllers/Edit.php`
- [ ] 编辑表单视图（复用创建表单）
- [ ] 加载现有文章数据
- [ ] 更新功能
- [ ] 版本历史（可选）
- [ ] 编辑冲突检测（多人编辑）

**预计工作量**: 4-6 小时

---

#### 删除文章（Delete）
**状态**: 未开始

**需要实现**:
- [ ] `Controllers/Delete.php`
- [ ] 软删除功能（deleted_at 字段）
- [ ] 确认对话框
- [ ] 批量删除
- [ ] 回收站功能（可选）
- [ ] 永久删除（管理员权限）

**预计工作量**: 2-3 小时

---

### 2.2 Markdown 支持

#### Markdown 渲染
**状态**: 未开始

**需要实现**:
- [ ] Markdown 解析器集成
  - 推荐：league/commonmark（PHP）
  - 支持 GitHub Flavored Markdown
- [ ] 代码高亮
  - 前端：Prism.js 或 Highlight.js
  - 支持多种语言
- [ ] 表格支持
- [ ] 任务列表支持
- [ ] Emoji 支持
- [ ] 数学公式支持（可选，KaTeX）

**预计工作量**: 4-5 小时

---

#### Markdown 编辑器
**状态**: 未开始

**需要实现**:
- [ ] EasyMDE 编辑器集成
- [ ] 工具栏配置
  - 加粗、斜体、删除线
  - 标题（H1-H6）
  - 列表（有序、无序）
  - 链接、图片
  - 代码块
  - 引用
  - 表格
- [ ] 实时预览
- [ ] 全屏模式
- [ ] 快捷键支持
- [ ] 拖拽上传图片

**预计工作量**: 6-8 小时

---

### 2.3 分类和标签系统

#### 数据库表设计
**状态**: 未开始

**需要创建**:
```sql
-- 分类表
CREATE TABLE zp_blog_categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    parent_id INT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_slug (slug),
    INDEX idx_parent (parent_id)
);

-- 标签表
CREATE TABLE zp_blog_tags (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    slug VARCHAR(50) NOT NULL UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_slug (slug)
);

-- 文章-分类关联表
CREATE TABLE zp_blog_post_category (
    post_id INT NOT NULL,
    category_id INT NOT NULL,
    PRIMARY KEY (post_id, category_id),
    INDEX idx_post (post_id),
    INDEX idx_category (category_id)
);

-- 文章-标签关联表
CREATE TABLE zp_blog_post_tag (
    post_id INT NOT NULL,
    tag_id INT NOT NULL,
    PRIMARY KEY (post_id, tag_id),
    INDEX idx_post (post_id),
    INDEX idx_tag (tag_id)
);
```

#### 功能实现
**需要实现**:
- [ ] 分类管理
  - 创建、编辑、删除分类
  - 层级分类（父子关系）
  - 分类树形展示
- [ ] 标签管理
  - 创建、编辑、删除标签
  - 标签云展示
  - 标签自动补全
- [ ] 文章关联
  - 选择分类（单选或多选）
  - 添加标签（多选）
  - 标签输入建议

**预计工作量**: 8-10 小时

---

### 2.4 图片和媒体管理

#### 图片上传
**状态**: 未开始

**需要实现**:
- [ ] 文件上传控制器
- [ ] 图片格式验证（jpg, png, gif, webp）
- [ ] 文件大小限制（2MB 默认）
- [ ] 图片压缩和优化
- [ ] 缩略图生成
- [ ] 存储方式
  - 本地存储（默认）
  - 云存储（七牛云、阿里云 OSS、AWS S3）
- [ ] 媒体库界面
  - 图片浏览
  - 图片搜索
  - 图片删除

**预计工作量**: 6-8 小时

---

### 2.5 外部平台发布

#### Medium 集成
**状态**: 未开始

**需要实现**:
- [ ] Medium API 客户端
- [ ] OAuth 认证流程
- [ ] 文章格式转换
- [ ] 发布到 Medium
- [ ] 同步状态追踪

**预计工作量**: 4-6 小时

---

#### Dev.to 集成
**状态**: 未开始

**需要实现**:
- [ ] Dev.to API 客户端
- [ ] API Key 配置
- [ ] Markdown 格式适配
- [ ] 发布到 Dev.to
- [ ] 封面图设置

**预计工作量**: 3-4 小时

---

#### Hashnode 集成
**状态**: 未开始

**需要实现**:
- [ ] Hashnode GraphQL API 客户端
- [ ] 认证流程
- [ ] 文章发布
- [ ] 标签映射

**预计工作量**: 4-5 小时

---

### 2.6 用户界面优化

#### 列表页面
**需要实现**:
- [ ] 响应式设计
- [ ] 表格布局
- [ ] 卡片布局（可选）
- [ ] 筛选侧边栏
- [ ] 快速操作按钮
- [ ] 加载动画

**预计工作量**: 6-8 小时

---

#### 编辑页面
**需要实现**:
- [ ] 两栏布局（编辑器 + 预览）
- [ ] 设置侧边栏
  - 发布状态
  - 分类选择
  - 标签输入
  - 封面图上传
  - SEO 设置
- [ ] 工具栏
- [ ] 保存状态提示

**预计工作量**: 8-10 小时

---

## 3. 技术债务

### 3.1 代码质量

#### 需要修复的问题
- [ ] **Leantime 核心 Bug**：`Plugins.php` 中的 ONLY_FULL_GROUP_BY 错误
  - 提交 Issue 给官方
  - 或提交 Pull Request
- [ ] 缺少数据验证层
- [ ] 缺少错误处理
- [ ] 缺少日志记录
- [ ] 缺少单元测试

**预计工作量**: 4-6 小时

---

### 3.2 安全性

#### 需要实现的安全措施
- [ ] CSRF 保护
- [ ] XSS 防护（Markdown 内容过滤）
- [ ] SQL 注入防护（使用 Prepared Statements）
- [ ] 文件上传安全
  - MIME 类型验证
  - 文件扩展名白名单
  - 文件大小限制
- [ ] 权限验证
  - 用户只能编辑自己的文章
  - 管理员可以编辑所有文章

**预计工作量**: 4-5 小时

---

### 3.3 性能优化

#### 需要优化的地方
- [ ] 数据库查询优化
  - 添加索引
  - 避免 N+1 查询
  - 使用 Eager Loading
- [ ] 缓存策略
  - 文章列表缓存
  - Markdown 渲染结果缓存
  - 分类和标签缓存
- [ ] 前端资源优化
  - CSS/JS 压缩
  - 图片懒加载
  - CDN 集成

**预计工作量**: 3-4 小时

---

## 4. 开发优先级

### P0 - 核心功能（必须完成）

**目标**: 可用的基础博客系统

1. **完整的 CRUD 操作** (16-20h)
   - [ ] 创建文章
   - [ ] 编辑文章
   - [ ] 删除文章
   - [ ] 文章列表

2. **Markdown 支持** (10-13h)
   - [ ] Markdown 编辑器
   - [ ] Markdown 渲染
   - [ ] 代码高亮

3. **基础 UI** (14-18h)
   - [ ] 列表页面
   - [ ] 创建/编辑页面
   - [ ] 响应式设计

4. **完整测试** (8-10h)
   - [ ] CRUD 测试
   - [ ] UI 测试
   - [ ] 集成测试

**总计**: 48-61 小时 ≈ **1.5-2 周**

---

### P1 - 增强功能（强烈推荐）

**目标**: 功能完善的博客系统

1. **分类和标签** (8-10h)
   - [ ] 数据库设计
   - [ ] 管理界面
   - [ ] 文章关联

2. **图片上传** (6-8h)
   - [ ] 上传功能
   - [ ] 媒体库
   - [ ] 图片优化

3. **发布管理** (4-6h)
   - [ ] 草稿/发布状态
   - [ ] 定时发布
   - [ ] 发布历史

4. **权限控制** (4-5h)
   - [ ] 用户权限验证
   - [ ] 角色管理集成

**总计**: 22-29 小时 ≈ **0.5-1 周**

---

### P2 - 高级功能（可选）

**目标**: 专业级博客系统

1. **外部平台发布** (11-15h)
   - [ ] Medium 集成
   - [ ] Dev.to 集成
   - [ ] Hashnode 集成

2. **SEO 优化** (4-6h)
   - [ ] Meta 标签管理
   - [ ] Sitemap 生成
   - [ ] Schema.org 标记

3. **分析统计** (6-8h)
   - [ ] 阅读量统计
   - [ ] 热门文章
   - [ ] 用户行为分析

4. **高级编辑器** (8-10h)
   - [ ] 所见即所得模式
   - [ ] 协作编辑
   - [ ] 版本历史

**总计**: 29-39 小时 ≈ **1 周**

---

## 5. 详细开发任务

### 第 1 阶段：核心 CRUD（1 周）

#### Sprint 1.1 - 文章创建（3 天）

**Day 1**:
- [ ] 创建 `Controllers/Create.php`
- [ ] 创建 `Views/create.blade.php`
- [ ] 集成 EasyMDE 编辑器
- [ ] 基础表单布局

**Day 2**:
- [ ] 表单验证
- [ ] 数据保存逻辑
- [ ] 草稿保存功能
- [ ] 错误处理

**Day 3**:
- [ ] 图片上传（基础版）
- [ ] 自动保存
- [ ] UI 优化
- [ ] 测试

---

#### Sprint 1.2 - 文章列表（2 天）

**Day 1**:
- [ ] 完善 `Controllers/ShowList.php`
- [ ] 创建 `Views/list.blade.php`
- [ ] 分页功能
- [ ] 搜索功能

**Day 2**:
- [ ] 过滤和排序
- [ ] 批量操作
- [ ] UI 优化
- [ ] 测试

---

#### Sprint 1.3 - 文章编辑和删除（2 天）

**Day 1**:
- [ ] 创建 `Controllers/Edit.php`
- [ ] 复用创建视图
- [ ] 加载现有数据
- [ ] 更新逻辑

**Day 2**:
- [ ] 创建 `Controllers/Delete.php`
- [ ] 软删除功能
- [ ] 确认对话框
- [ ] 测试

---

### 第 2 阶段：Markdown 和 UI（3-4 天）

#### Sprint 2.1 - Markdown 渲染（1 天）
- [ ] 集成 league/commonmark
- [ ] 配置 GFM 扩展
- [ ] 代码高亮
- [ ] 测试

#### Sprint 2.2 - 编辑器增强（2 天）
- [ ] EasyMDE 配置优化
- [ ] 实时预览
- [ ] 工具栏定制
- [ ] 快捷键
- [ ] 拖拽上传

#### Sprint 2.3 - UI 优化（1-2 天）
- [ ] 响应式设计
- [ ] 样式优化
- [ ] 加载动画
- [ ] 用户体验优化

---

### 第 3 阶段：增强功能（1 周）

#### Sprint 3.1 - 分类和标签（3 天）
- [ ] 数据库迁移
- [ ] Models 创建
- [ ] Repositories 实现
- [ ] 管理界面
- [ ] 文章关联
- [ ] 测试

#### Sprint 3.2 - 图片管理（2 天）
- [ ] 上传控制器
- [ ] 媒体库界面
- [ ] 图片优化
- [ ] 云存储集成（可选）
- [ ] 测试

#### Sprint 3.3 - 发布管理（2 天）
- [ ] 状态管理
- [ ] 定时发布
- [ ] 权限控制
- [ ] 测试

---

## 6. 测试计划

### 6.1 单元测试

**覆盖范围**:
- [ ] Models 测试
- [ ] Repositories 测试
- [ ] Services 测试
- [ ] 工具类测试

**工具**: PHPUnit

**预计工作量**: 6-8 小时

---

### 6.2 集成测试

**覆盖范围**:
- [ ] 创建文章流程
- [ ] 编辑文章流程
- [ ] 删除文章流程
- [ ] API 测试
- [ ] 外部平台发布测试

**工具**: PHPUnit + Playwright

**预计工作量**: 8-10 小时

---

### 6.3 UI/E2E 测试

**覆盖范围**:
- [ ] 登录流程
- [ ] 菜单导航
- [ ] 文章 CRUD 完整流程
- [ ] 图片上传
- [ ] 分类和标签操作
- [ ] 响应式测试（移动端）

**工具**: Playwright

**预计工作量**: 10-12 小时

---

## 7. 性能优化

### 7.1 数据库优化

**任务**:
- [ ] 添加必要的索引
  ```sql
  ALTER TABLE zp_blog_posts ADD INDEX idx_status (status);
  ALTER TABLE zp_blog_posts ADD INDEX idx_created_at (created_at);
  ALTER TABLE zp_blog_posts ADD INDEX idx_author (author_id);
  ```
- [ ] 优化查询语句
- [ ] 使用 Eager Loading 避免 N+1 问题

**预计工作量**: 2-3 小时

---

### 7.2 缓存策略

**任务**:
- [ ] 文章列表缓存（Redis）
- [ ] Markdown 渲染缓存
- [ ] 分类和标签缓存
- [ ] 配置缓存失效策略

**预计工作量**: 3-4 小时

---

### 7.3 前端优化

**任务**:
- [ ] CSS/JS 压缩和合并
- [ ] 图片懒加载
- [ ] CDN 配置
- [ ] Service Worker（可选）

**预计工作量**: 2-3 小时

---

## 8. 文档和部署

### 8.1 用户文档

**需要编写**:
- [ ] 用户使用指南
  - 如何创建文章
  - 如何使用 Markdown
  - 如何上传图片
  - 如何发布到外部平台
- [ ] 管理员指南
  - 插件配置
  - 权限设置
  - 性能优化建议
- [ ] FAQ

**预计工作量**: 4-6 小时

---

### 8.2 API 文档

**需要编写**:
- [ ] API 端点列表
- [ ] 请求/响应格式
- [ ] 认证方式
- [ ] 示例代码

**工具**: Postman Collection 或 Swagger

**预计工作量**: 3-4 小时

---

### 8.3 部署指南

**需要编写**:
- [ ] 安装步骤
- [ ] 配置说明
- [ ] 故障排查
- [ ] 升级指南

**预计工作量**: 2-3 小时

---

## 9. 里程碑和时间线

### Milestone 1: MVP（最小可行产品）- 2 周

**目标**: 基础博客功能可用

**完成标准**:
- [x] 插件成功安装和启用
- [x] 菜单显示正常
- [ ] 可以创建、编辑、删除文章
- [ ] Markdown 编辑和渲染正常
- [ ] 基础 UI 完整
- [ ] 核心功能测试通过

**预计完成日期**: 2025-12-28

---

### Milestone 2: Feature Complete（功能完整）- 3 周

**目标**: 所有 P0 和 P1 功能完成

**完成标准**:
- [ ] 分类和标签系统完整
- [ ] 图片上传和管理
- [ ] 发布管理功能
- [ ] 权限控制
- [ ] 完整测试覆盖
- [ ] 性能优化完成

**预计完成日期**: 2026-01-11

---

### Milestone 3: Production Ready（生产就绪）- 4 周

**目标**: 可以正式发布

**完成标准**:
- [ ] 外部平台发布功能
- [ ] SEO 优化
- [ ] 完整文档
- [ ] 安全审计通过
- [ ] 性能测试通过
- [ ] 用户验收测试通过

**预计完成日期**: 2026-01-25

---

## 10. 风险和缓解措施

### 风险 1: Leantime 核心 Bug

**描述**: ONLY_FULL_GROUP_BY 错误影响插件加载

**影响**: 高

**缓解措施**:
- 提交 Issue 给官方
- 提交 Pull Request 修复
- 文档中说明解决方案

---

### 风险 2: 外部 API 限制

**描述**: Medium、Dev.to 等平台 API 可能有限制

**影响**: 中

**缓解措施**:
- 研究 API 文档
- 实现请求限流
- 提供错误处理和重试机制

---

### 风险 3: 性能问题

**描述**: 大量文章时列表加载慢

**影响**: 中

**缓解措施**:
- 分页限制（每页 20 条）
- 添加数据库索引
- 实现缓存策略

---

### 风险 4: 安全漏洞

**描述**: XSS、CSRF、SQL 注入等

**影响**: 高

**缓解措施**:
- 使用 Leantime 内置安全机制
- 代码审查
- 安全测试

---

## 11. 资源需求

### 开发人员

- **后端开发**: 1 人 x 3 周 = 120 小时
- **前端开发**: 1 人 x 2 周 = 80 小时
- **测试**: 1 人 x 1 周 = 40 小时
- **文档**: 1 人 x 3 天 = 24 小时

**总计**: 264 小时 ≈ **33 人天** ≈ **1.5 月**

---

### 第三方服务

- **云存储**（可选）: 七牛云/阿里云 OSS
- **CDN**（可选）: Cloudflare
- **监控**（可选）: Sentry

---

## 12. 成功标准

### 功能完整性

- [ ] 所有 P0 功能实现并测试通过
- [ ] 至少 80% 的 P1 功能实现
- [ ] 无阻塞性 Bug

### 性能指标

- [ ] 文章列表加载时间 < 1 秒
- [ ] 创建文章响应时间 < 2 秒
- [ ] Markdown 渲染时间 < 500ms

### 质量指标

- [ ] 代码覆盖率 > 70%
- [ ] E2E 测试通过率 100%
- [ ] 无严重安全漏洞

### 用户体验

- [ ] UI 响应式设计完整
- [ ] 操作流程顺畅
- [ ] 错误提示清晰
- [ ] 文档完整易懂

---

## 13. 总结

### 关键路径

1. **Week 1-2**: 核心 CRUD + Markdown + 基础 UI
2. **Week 3**: 分类标签 + 图片上传 + 发布管理
3. **Week 4**: 外部平台 + SEO + 文档

### 快速启动建议

**如果时间有限，优先实现**:
1. 创建文章（带 Markdown 编辑器）
2. 文章列表（带分页）
3. 编辑和删除
4. 基础 UI

这样可以在 **1-2 周内**交付一个可用的 MVP。

### 长期维护计划

- 定期更新依赖
- 监控 Leantime 核心更新
- 收集用户反馈
- 持续优化性能
- 定期安全审计

---

**文档版本**: 1.0
**最后更新**: 2025-12-14
**作者**: Claude Code
**状态**: 规划中
**下次审查**: MVP 完成后
